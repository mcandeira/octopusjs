/**
 * OctopusJS | v1.4.0 "Abyssal Octopus" ðŸ™ 
 * ------------------------------------
 * High-performance distributed intelligence frontend development framework.
 * * @author Miguel Candeira Carrera
 * @license MIT
 * @see {@link https://github.com/mcandeira/octopusjs}
 * @release Supervised and improved with the invaluable assistance of Gemini (Google AI).
 * * Characteristics:
 * - 17kB footprint (~5.3kB Gzipped)
 * - 0.07s LCP | 0.02s CLS
 * - Native ESM Architecture
 * * Copyright (c) 2026 Miguel Candeira Carrera
 * * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
 * -----------------------------------------------------
 */
var c={error:i=>`[Octopus Periferic Error] ${i}`,constant:{methodNotExist:i=>c.error(`The "${i}" HTMLElement method does not exist.`),notHimself:()=>c.error('The "into" option requires a relative element different from himself.'),unOverriddenValue:i=>c.error(`The "${i}" value cannot be overridden.`),unOverriddenHelper:i=>c.error(`The "${i}" helper cannot be overridden.`),unOverriddenAction:i=>c.error(`The ${i} action cannot be overridden.`),unOverriddenProp:i=>c.error(`The ${i} prop cannot be overridden.`),unOverriddenListener:i=>c.error(`The "${i}" child listener cannot be overridden.`),parentPropNotFound:i=>c.error(`Prop "${i}" parent not found.`),parentListenerNotFound:i=>c.error(`Listener "${i}" parent not found.`),invalidValidateArguments:(i,t)=>c.error(`Invalid validate arguments in: ${i}, parameter position '${t}'. Expected at least one value and one check type.`),invalidArgumentType:(i,t,e,n)=>c.error(`Invalid argument type in: ${i}, parameter position '${t}'. Expected: ${n}, got ${e}.`)},function:{validate(i,...t){let e=t.length;for(let n=0;n<e;n++){let[r,...o]=t[n];if(o.length===0)throw new Error(c.constant.invalidValidateArguments(i.name,n+1));let s=!1;for(let a of o)if(a==null&&a===r||a&&Object(r)instanceof a){s=!0;break}if(!s){let a=r?.constructor?.name??typeof r,u=o.map(d=>d?.name??String(d)).join(" | ");throw new TypeError(c.constant.invalidArgumentType(i.name,n+1,a,u))}}}}};var l=class{static nerveRing=new Map;static setData(t,e,n,r,o=!1){let s=t.get(`${e}::${n}`);if(!o&&s?.data!==void 0)return!1;let a=s?.__waiters?.filter(u=>u.remember);return t.set(`${e}::${n}`,{data:r,__waiters:a??[]}),s}static receiveData(t,e,n,r,o=!1){let s=t.get(`${e}::${n}`);return s?(s.data===void 0||o)&&s.__waiters.push({value:r,remember:o}):t.set(`${e}::${n}`,{data:void 0,__waiters:[{value:r,remember:o}]}),s}static setValue(t,e,n=!1){c.function.validate(this.setValue,[t,String],[n,Boolean]);let r=this.setData(this.nerveRing,"val",t,e,n);r===!1?console.warn(c.constant.unOverriddenValue(t)):r&&r.__waiters?.forEach(o=>{o.value(e)})}static receiveValue(t,e,n=!0){c.function.validate(this.receiveValue,[t,String],[e,Function],[n,Boolean]);let r=this.receiveData(this.nerveRing,"val",t,e,n);r?.data!==void 0&&e(r.data)}static setProtected(t,e,n){c.function.validate(this.setProtected,[t,String],[n,String]);let r=this.setData(this.nerveRing,"pro",`${t}::${n}`,e,!0);r&&r.__waiters?.forEach(o=>{o.value(e)})}static receiveProtected(t,e,n,r=!0){c.function.validate(this.receiveProtected,[t,String],[e,String],[n,Function],[r,Boolean]);let o=this.receiveData(this.nerveRing,"pro",`${t}::${e}`,n,r);o?.data!==void 0&&n(o.data)}static setHelper(t,e,n=!1){c.function.validate(this.setHelper,[t,String],[e,Function],[n,Boolean]);let r=this.setData(this.nerveRing,"help",t,e,n);r===!1?console.warn(c.constant.unOverriddenHelper(t)):r&&r.__waiters?.forEach(o=>{o.value(e)})}static receiveHelper(t,e,n=!1){c.function.validate(this.receiveHelper,[t,String],[e,Function],[n,Boolean]);let r=this.receiveData(this.nerveRing,"help",t,e,n);r?.data!==void 0&&e(r.data)}static setAction(t,e,n=!1){c.function.validate(this.setAction,[t,String],[e,Function],[n,Boolean]);let r=this.setData(this.nerveRing,"act",t,e,n);r===!1?console.warn(c.constant.unOverriddenAction(t)):r&&r.__waiters?.forEach(o=>{e(o.value)})}static triggerAction(t,e=void 0,n=!1){c.function.validate(this.triggerAction,[t,String],[n,Boolean]);let r=this.receiveData(this.nerveRing,"act",t,e,n);r?.data!==void 0&&r.data(e)}static nerveCord=new WeakMap;static setProp(t,e,n,r=!1){c.function.validate(this.setProp,[t,Element],[e,String],[r,Boolean]);let o=this.nerveCord.get(t);if(!o){let a=new Map;this.nerveCord.set(t,a),o=a}let s=this.setData(o,"prop",e,n,r);s===!1?console.warn(c.constant.unOverriddenProp(e),t):s&&s.__waiters?.forEach(a=>{a.value(n)})}static receiveProp(t,e,n,r=!0){c.function.validate(this.receiveProp,[t,Element],[e,String],[n,Function],[r,Boolean]);let o=t.parentElement?.closest("*:has(> script.octopus)");if(!o){console.warn(c.constant.parentPropNotFound(e),t);return}let s=this.nerveCord.get(o);if(!s){let u=new Map;this.nerveCord.set(t,u),s=u}let a=this.receiveData(s,"prop",e,n,r);a?.data!==void 0&&n(a.data)}static setChildListener(t,e,n,r=!1){c.function.validate(this.setChildListener,[t,Element],[e,String],[n,Function],[r,Boolean]);let o=this.nerveCord.get(t);if(!o){let a=new Map;this.nerveCord.set(t,a),o=a}let s=this.setData(o,"listener",e,n,r);s===!1?console.warn(c.constant.unOverriddenListener(e),t):s&&s.__waiters?.forEach(a=>{n(a.value)})}static receiveChildListener(t,e,n=null,r=!1){c.function.validate(this.receiveChildListener,[t,Element],[e,String],[r,Boolean]);let o=t.parentElement?.closest("*:has(> script.octopus)");if(!o){console.warn(c.constant.parentListenerNotFound(e),t);return}let s=this.nerveCord.get(o);if(!s){let u=new Map;this.nerveCord.set(t,u),s=u}let a=this.receiveData(s,"listener",e,n,r);a?.data!==void 0&&a.data(n)}};var h=class{softStorage;hardStorage;constructor(){this.softStorage=new Map,this.hardStorage=new Map}process(t,e){let n=t.length;if(n>1e4)return this.hardProcess(t,e);let r=this.softStorage,o=n<64?t:this.stringToHash(t);if(!r.has(o)){let u=e(t);return r.set(o,void 0),u}let s=r.get(o);if(s)return s;let a=e(t);return r.set(o,a),a}hardProcess(t,e){let n=t.length,r=this.hardStorage;if(!r.has(n)){let d=e(t);return r.set(n,new Map),d}let o=r.get(n),s=this.stringToHash(t);if(!o?.size){let d=e(t);return o?.set(s,d),d}let a=o.get(s);if(a)return a;let u=e(t);return o.set(s,u),u}stringToHash(t){let e=5381;for(let n=0;n<length;n++)e=(e<<5)+e+t.charCodeAt(n);return e>>>0}};var p=class i{static cache=new h;static stringToFragment(t){return this.cache.process(t,n=>i.generateFragment(n)).cloneNode(!0)}static generateFragment(t){let e=document.createElement("template");return e.innerHTML=t,t.includes("<script")&&this.fixScripts(e.content),e.content}static fixScripts(t){for(let e of t.querySelectorAll("template, script"))if(e instanceof HTMLTemplateElement)this.fixScripts(e.content);else{let n=document.createElement("script");Array.from(e.attributes).forEach(r=>n.setAttribute(r.name,r.value)),n.type="module",n.textContent=e.textContent,e.replaceWith(n)}}};var m={error:i=>`[Octopus Parser Error] ${i}`,constant:{startDelimiter:"8{",endDelimiter:"}",REGEX_VARS:/\{\{([^}]+)\}\}/g,unknownMark:i=>m.error(`Mark "${i} unknown."`)},function:{resolveValue(i,t){if(!i)return!1;let e=t,n=0;for(let r=0;r<=i.length;r++)if(r===i.length||i[r]==="."){let o=i.substring(n,r);if(e=e?.[o],e===void 0)return;n=r+1}return e},escapeHTML(i){return typeof i!="string"?i:i.replace(/[&<>"']/g,t=>t==="&"?"&amp;":t==="<"?"&lt;":t===">"?"&gt;":t==='"'?"&quot;":"&#39;")}}};var v=class{static createTag(t,e,n){return new F(t,e,n)}},F=class{start;end;headers;closeTag;constructor(t,e,n){this.start=t,this.end=e,this.headers=n}};var y=class i{static render(t,e,n){let r=this.process(t);switch(e){case"beforebegin":n.before(r);break;case"afterbegin":n.prepend(r);break;case"beforeend":n.append(r);break;case"afterend":n.after(r);break;case"into":n.replaceChildren(r);break;default:n.appendChild(r);break}}static process(t){if(t=t.ref??t,Array.isArray(t)&&t.length===2){let e=t[0].ref??t[0];if(e instanceof Element)e=e.innerHTML;else if(typeof e!="string")throw new TypeError("[Octopus] Render Error: Invalid Template Argument");let n=this.processTemplate(e,t[1]);return p.stringToFragment(n)}if(t instanceof Element)return p.stringToFragment(t.innerHTML);if(typeof t=="string")return p.stringToFragment(t);throw new TypeError("[Octopus] Render Error: Invalid Template Argument")}static processTemplate(t,e){let n=[],r=0;for(;;){let s=this.getPairedMarks(t,r);if(!s){r<t.length&&n.push(t.substring(r));break}if(n.push(t.substring(r,s.start)),!s.closeTag){console.warn(`[Octopus] Template Warning: Unclosed or unknown mark '${s.headers[0]}'`),n.push(t.substring(s.start,s.end)),r=s.end;continue}let a=s.headers[0];this.directives[a]?n.push(this.directives[a](s,e,t)):n.push(t.substring(s.start,s.closeTag.end)),r=s.closeTag.end}return n.join("").replace(this.#t,([],s)=>s.trim().split(".").reduce((u,d)=>u?.[d],e)??"")}static#t=/\{\{([^}]+)\}\}/g;static directives={if(t,e,n){let r=t.headers[1];if(r?r.split(".").reduce((s,a)=>s?.[a],e):!1){let s=n.substring(t.end,t.closeTag?.start);return i.processTemplate(s,e)}return""},for(t,e,n){let r=t.headers[3],o=r?r.split(".").reduce((s,a)=>s?.[a],e):null;if(Array.isArray(o)){let s=n.substring(t.end,t.closeTag?.start),a=t.headers[1],u=[];for(let d of o){let S=Object.create(e);S[a]=d,u.push(i.processTemplate(s,S))}return u.join("")}return""}};static getPairedMarks(t,e=0){let n=this.getMark(t,e);if(!n)return;let r=n.headers[0];if(r!=="if"&&r!=="for")return n;let o=0,s=n.end;for(;;){let a=this.getMark(t,s);if(!a)throw Error(`[Octopus] Template Syntax Error: Unclosed '${r}' mark starting at index ${n.start}.`);switch(s=a.end,a.headers[0]){case"if":case"for":o++;break;case"endif":if(o>0){o--;continue}if(r!=="if")throw Error(`[Octopus] Template Syntax Error: Unexpected 'endif' for '${r}' mark.`);n.closeTag=a;break;case"endfor":if(o>0){o--;continue}if(r!=="for")throw Error(`[Octopus] Template Syntax Error: Unexpected 'endfor' for '${r}' mark.`);n.closeTag=a;break}if(n.closeTag)break}return n}static#e=/\s+/;static getMark(t,e=0){let n=m.constant.startDelimiter,r=n.length,o=m.constant.endDelimiter,s=o.length,a=t.indexOf(n,e);if(a<0)return;let u=t.indexOf(o,a);if(u<0)return;let d=t.substring(a+r,u).trim().split(this.#e);if(!(d.length<1||d[0]===""))return v.createTag(a,u+s,d)}};var D=Array.from(document.querySelectorAll("script.octopus")).reverse(),f=class i{_ref;constructor(t){let e=t===void 0?D.pop()?.parentElement:typeof t=="string"?document.querySelector(t):t;c.function.validate(this.constructor,[e,Element]),this._ref=e}get ref(){return this._ref}getChild(t){c.function.validate(this.getChild,[t,String]);let e=this._ref.querySelector(t);return e?new i(e):void 0}set(t,e){return c.function.validate(this.set,[t,String]),t in this._ref?this._ref[t]=e:this._ref.setAttribute(t,e),this}get(t){return c.function.validate(this.get,[t,String]),t in this._ref?this._ref[t]:this._ref.getAttribute(t)}use(t,...e){c.function.validate(this.use,[t,String]);let n=this._ref;if(typeof n[t]=="function")return n[t](...e);throw new Error(c.constant.methodNotExist(t))}deleteAll(t){c.function.validate(this.deleteAll,[t,String]);let e=this._ref.querySelectorAll(t);for(let n of e)n.remove()}onMount(t){c.function.validate(this.onMount,[t,Function]),document.body.contains(this._ref)?t():new MutationObserver(([],e)=>{document.body.contains(this._ref)&&(t(),e.disconnect())}).observe(document.body,{childList:!0,subtree:!0})}onUnmount(t){c.function.validate(this.onUnmount,[t,Function]),new MutationObserver(([],e)=>{document.body.contains(this._ref)||(t(),e.disconnect())}).observe(document.body,{childList:!0,subtree:!0})}setValue(t,e,n=!1){l.setValue(t,e,n)}receiveValue(t,e,n=!0){l.receiveValue(t,e,n)}setProtected(t,e,n){l.setProtected(t,e,n)}receiveProtected(t,e,n,r=!0){l.receiveProtected(t,e,n,r)}setHelper(t,e,n=!1){l.setHelper(t,e,n)}receiveHelper(t,e,n=!1){l.receiveHelper(t,e,n)}setAction(t,e,n=!1){l.setAction(t,e,n)}triggerAction(t,e=void 0,n=!1){l.triggerAction(t,e,n)}setProp(t,e,n=!1){l.setProp(this._ref,t,e,n)}receiveProp(t,e,n=!0){l.receiveProp(this._ref,t,e,n)}setChildListener(t,e,n=!1){l.setChildListener(this._ref,t,e,n)}receiveChildListener(t,e,n=!1){l.receiveChildListener(this._ref,t,e,n)}render(t,e="default",n=this._ref){y.render(t,e,n instanceof i?n._ref:n)}};var b=class{static getTemplates(){return`
            <div id="octopusTemplates">
                ${this.octopusDialogTemplate()}
            </div>
        `}static octopusDialogTemplate(){return`
            <template id="octopusDialogTemplate">
                <dialog id="{{ id }}" class="{{ classes }}">
                    <div>
                        {{ message }}
                        8{for option in options}
                            {{ option }}
                        8{endfor}
                        <button>Close</button>
                    </div>

                    <script type="module">
                        import { octopus } from 'octopus-js-native'

                        const component = octopus.getComponent('#{{ id }}')
                        const button = component.getChild('button')

                        button.use('addEventListener', 'click', () => {
                            component.use('close')
                            component.use('remove')
                        })
                    <\/script>

                    <style>
                        @scope{
                            >div{
                                display: flex;
                                flex-direction: column;
                            }
                        }
                    </style>
                </dialog>
            </template>
        `}};var g={error:i=>`[Octopus Control Error] ${i}`,constant:{requestError:i=>g.error(`Request: ${i}`),autoProcessError:i=>g.error(`Invalid data received in ${i}.`),dialogTemplateNotFound:i=>g.error(`Template "#octopusDialogTemplate" not found in ${i}.`)},function:{generateDialog(i,t,e="",n=void 0){let r=new f("body"),o=r.getChild("#octopusDialogTemplate");if(!o){console.warn(g.constant.dialogTemplateNotFound(g.function.generateDialog.name));return}i=`${i}Dialog`;let s=r.getChild(`#${i}`);s&&s.use("remove"),r.render([o,{message:t,classes:e,options:n,id:i}]),r.getChild(`#${i}`)?.use("showModal")}}};var E=class{constructor(t){if(!t||typeof t!="object"){console.error(g.constant.autoProcessError(this.constructor.name));return}if(t instanceof Error){g.function.generateDialog("error",t.message,"bg-danger");return}t.message&&g.function.generateDialog("message",t.message.content??t.message,t.message.classes,t.message.options),t.error&&g.function.generateDialog("error",t.error,"bg-danger")}};var T=class{url;data;constructor(t,e=void 0){this.url=t,this.data=e}get(t,e=t){let n=this.data?new URLSearchParams(this.data).toString():"",r=this.url.includes("?")?"&":"?",o=n?`${this.url}${r}${n}`:this.url;this.fetch(new Request(o),t,e)}post(t,e=t){this.fetch(new Request(this.url,{method:"POST",body:this.data}),t,e)}autoprocess(){this.post(t=>{new E(t)})}fetch(t,e,n){fetch(t).then(r=>{if(!r.ok)throw{error:g.constant.requestError(`${r.status} ${r.statusText}`)};let o=r.headers.get("Content-Type");return o&&o.includes("application/json")?r.json():r.text()}).then(r=>{e(r)}).catch(r=>{n(r)})}};var w=class{static takeControl(){let t=new f("body");t.render(b.getTemplates()),t.use("addEventListener","submit",e=>{e.preventDefault();let n=e.target;new T(n.action,new FormData(n)).autoprocess()})}};var A=class{constructor(){}static getComponent(t){return new f(t)}static setValue(t,e,n=!1){l.setValue(t,e,n)}static receiveValue(t,e,n=!0){l.receiveValue(t,e,n)}static setProtected(t,e,n){l.setProtected(t,e,n)}static receiveProtected(t,e,n,r=!0){l.receiveProtected(t,e,n,r)}static setHelper(t,e,n=!1){l.setHelper(t,e,n)}static receiveHelper(t,e,n=!1){l.receiveHelper(t,e,n)}static setAction(t,e,n=!1){l.setAction(t,e,n)}static triggerAction(t,e=void 0,n=!1){l.triggerAction(t,e,n)}static fullActive(){w.takeControl()}};export{A as octopus};
//# sourceMappingURL=octopus.min.js.map
