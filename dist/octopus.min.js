/**
 * OctopusJS | v1.2.0 "Abyssal Octopus" ðŸ™ 
 * ------------------------------------
 * High-performance distributed intelligence frontend development framework.
 * * @author Miguel Candeira Carrera
 * @license MIT
 * @see {@link https://github.com/mcandeira/octopusjs}
 * @release Supervised and improved with the invaluable assistance of Gemini (Google AI).
 * * Characteristics:
 * - 12kB footprint (~3.8kB Gzipped)
 * - 0.07s LCP | 0.02s CLS
 * - Native ESM Architecture
 * * Copyright (c) 2026 Miguel Candeira Carrera
 * * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
 * -----------------------------------------------------
 */
var h=class a{static getTemplate(t){if(t=t.ref??t,Array.isArray(t)&&t.length===2){let e=t[0].ref??t[0];if(e instanceof Element)e=e.innerHTML;else if(typeof e!="string")throw new TypeError("[Octopus] Render Error: Invalid Template Argument");return this.stringToTemplate(this.processTemplate(e,t[1]))}if(t instanceof Element)return this.stringToTemplate(t.innerHTML);if(typeof t=="string")return this.stringToTemplate(t);throw new TypeError("[Octopus] Render Error: Invalid Template Argument")}static#t=/\s+/;static#e=/\{\{([^}]+)\}\}/g;static directives={if(t,e,n){let r=t.contents[1];if(r?r.split(".").reduce((o,i)=>o?.[i],e):!1){let o=n.substring(t.ending,t.closeTag.starting);return this.processTemplate(o,e)}return""},for(t,e,n){let r=t.contents[3],s=r?r.split(".").reduce((o,i)=>o?.[i],e):null;if(Array.isArray(s)){let o=n.substring(t.ending,t.closeTag.starting),i=t.contents[1],f=[];for(let l of s){let y=Object.create(e);y[i]=l,f.push(a.processTemplate(o,y))}return f.join("")}return""}};static processTemplate(t,e){let n=[],r=0;try{for(;;){let o=this.getPairedTags("8{","}",t,r);if(!o){r<t.length&&n.push(t.substring(r));break}if(n.push(t.substring(r,o.starting)),!o.closeTag){console.warn(`[Octopus] Template Warning: Unclosed or unknown tag '${o.contents[0]}'`),n.push(t.substring(o.starting,o.ending)),r=o.ending;continue}let i=o.contents[0];this.directives[i]?n.push(this.directives[i](o,e,t)):n.push(t.substring(o.starting,o.closeTag.ending)),r=o.closeTag.ending}}catch(o){return console.error(o),`<div style="color:red; border:1px solid red; padding:10px;">Octopus Error: ${o.message}</div>`}return n.join("").replace(this.#e,(o,i)=>i.trim().split(".").reduce((l,y)=>l?.[y],e)??"")}static getPairedTags(t,e,n,r=0){let s=this.getTag(t,e,n,r);if(!s)return s;let o=s.contents[0];if(o!=="if"&&o!=="for")return s;let i=0,f=s.ending;for(;;){let l=this.getTag(t,e,n,f);if(!l)throw Error(`[Octopus] Template Syntax Error: Unclosed '${o}' tag starting at index ${s.starting}.`);switch(f=l.ending,l.contents[0]){case"if":case"for":i++;break;case"endif":if(i>0){i--;continue}if(o!=="if")throw Error(`[Octopus] Template Syntax Error: Unexpected 'endif' for '${o}' tag.`);s.closeTag=l;break;case"endfor":if(i>0){i--;continue}if(o!=="for")throw Error(`[Octopus] Template Syntax Error: Unexpected 'endfor' for '${o}' tag.`);s.closeTag=l;break}if(s.closeTag)break}return s}static getTag(t,e,n,r=0){let s=n.indexOf(t,r);if(s<0)return null;let o=n.indexOf(e,s);if(o<0)return null;let i=n.substring(s+t.length,o).trim().split(this.#t);return i.length<1||i[0]===""?null:{contents:i,starting:s,ending:o+e.length}}static stringToTemplate(t){let e=document.createElement("template");return e.innerHTML=t,this.fixScripts(e),e}static fixScripts(t){let e=t.content;for(let n of e.querySelectorAll("template"))this.fixScripts(n);for(let n of e.querySelectorAll("script")){let r=document.createElement("script");Array.from(n.attributes).forEach(s=>r.setAttribute(s.name,s.value)),r.type="module",r.textContent=n.textContent,n.replaceWith(r)}}};var m=Array.from(document.querySelectorAll("script.octopus")).reverse(),p=class a{#t;constructor(t){if(t instanceof Element?this.#t=t:typeof t=="string"?this.#t=document.querySelector(t):t===void 0&&(this.#t=m.pop()?.parentNode),!this.#t)throw new TypeError("[Octopus] Unexpected OctopusComponent Argument")}get ref(){return this.#t}getChild(t){let e=this.#t.querySelector(t);return e&&new a(e)}set(t,e){return this.#t[t]=e,this}get(t){return this.#t[t]}use(t,...e){if(typeof this.#t[t]=="function")return this.#t[t](...e);throw Error(`The ${t} method does not exist.`)}deleteAll(t){for(let e of this.#t.querySelectorAll(t))e.remove()}onMount(t){document.body.contains(this.#t)?t():new MutationObserver((e,n)=>{document.body.contains(this.#t)&&(t(),n.disconnect())}).observe(document.body,{childList:!0,subtree:!0})}onUnmount(t){new MutationObserver((e,n)=>{document.body.contains(this.#t)||(t(),n.disconnect())}).observe(document.body,{childList:!0,subtree:!0})}setVal(t,e,n=!1){c.setVal(t,e,n)}getVal(t){return c.getVal(t)}setHelper(t,e,n=!1){c.setHelper(t,e,n)}getHelper(t){return c.getHelper(t)}setAction(t,e,n=!1){c.setAction(t,e,n)}triggerAction(t,e=null){c.triggerAction(t,e)}setSecret(t,e,n,r=!1){c.setSecret(t,e,n,r)}getSecret(t,e){return c.getSecret(t,e)}static#e=new WeakMap;setProp(t,e,n=!1){let r=a.#e;if(!n&&r.get(this.#t)?.has(t)){console.warn(`[Octopus] The prop "${t}" already exists.`,this.#t);return}r.get(this.#t)||r.set(this.#t,new Map),r.get(this.#t).set(t,e)}getProp(t){let e=this.#t.closest("*:has(> script.octopus):not(:scope)");if(!e){console.warn(`[Octopus] Parent not found for prop "${t}"`,this.#t);return}let n=a.#e.get(e)?.get(t);if(n===void 0){console.warn(`[Octopus] The prop "${t}" doesn't exist.`,this.#t);return}return n}listenChild(t,e,n=!1){let r=a.#e,s=`childListener-${t}`;if(!n&&r.get(this.#t)?.has(s)){console.warn(`[Octopus] The child listener "${s}" already exists.`,this.#t);return}r.get(this.#t)||r.set(this.#t,new Map),r.get(this.#t).set(s,e)}sendParent(t,e){let n=`childListener-${t}`,r=this.#t.closest("*:has(> script.octopus):not(:scope)");if(!r){console.warn(`[Octopus] Parent not found for listener "${t}"`,this.#t);return}let s=a.#e.get(r)?.get(n);if(!s){console.warn(`[Octopus] The child listener "${n}" doesn't exist.`,this.#t);return}s(e)}render(t,e="after",n){let r=h.getTemplate(t).content,s=n?.ref??n;switch(e){case"into":if(!s)throw Error('The "into" option requires a relative element as the third argument');s.innerHTML="",s.append(r);break;case"before":s?s.before(r):this.ref.prepend(r);break;default:s?s.after(r):this.ref.append(r);break}}};var u=class{static generateDialog(t,e,n,r=null){t=`${t}Dialog`;let s=new p("body"),o=s.getChild("#octopusDialogTemplate");if(!o){console.warn('[Octopus] Dialog Error: Template "#octopusDialogTemplate" not found.');return}let i=s.getChild(`#${t}`);i&&i.use("remove"),s.render([o,{message:e,classes:n,options:r,dialogID:t}]),s.getChild(`#${t}`)?.use("showModal")}static getTemplates(){return`
            <div id="octopusTemplates">
                ${this.#t()}
            </div>
        `}static#t(){return`
            <template id="octopusDialogTemplate">
                <dialog id="{{ dialogID }}" class="{{ classes }}">
                    <div>
                        {{ message }}
                        8{for option in options}
                            {{ option }}
                        8{endfor}
                        <button>Close</button>
                    </div>

                    <script type="module">
                        import { octopus } from 'octopus-js-native'

                        const component = octopus.getComponent('#{{ dialogID }}')
                        const button = component.getChild('button')

                        button.use('addEventListener', 'click', () => {
                            component.use('close')
                            component.use('remove')
                        })
                    <\/script>

                    <style>
                        @scope{
                            >div{
                                display: flex;
                                flex-direction: column;
                            }
                        }
                    </style>
                </dialog>
            </template>
        `}};var g=class{constructor(t){if(!t){console.warn("[Octopus] AutoProcess Error: No data received.");return}t.message&&u.generateDialog("message",t.message.content,t.message.classes,t.message.options),t.error&&u.generateDialog("error",t.error,"bg-danger")}};var d=class{url;data;constructor(t,e=null){this.url=t,this.data=e}get(t,e=t){this.#t(new Request(`${this.url}${this.data?"?"+new URLSearchParams(this.data):""}`),t,e)}post(t,e=t){this.#t(new Request(this.url,{method:"POST",body:this.data}),t,e)}autoprocess(){this.post(t=>{new g(t)})}#t(t,e,n){fetch(t).then(r=>{if(!r.ok)throw{error:`[Octopus] Request Error: ${r.status} ${r.statusText}.`};let s=r.headers.get("Content-Type");return s&&s.includes("application/json")?r.json():r.text()}).then(r=>{e(r)}).catch(r=>{n(r)})}};var c=class a{static getComponent(t){return new p(t)}static#t=new Map;static setVal(t,e,n=!1){if(!n&&a.#t.has(t)){console.warn(`[Octopus] The val "${t}" already exists.`);return}a.#t.set(t,e)}static getVal(t){return a.#t.get(t)}static#e=new Map;static setHelper(t,e,n=!1){if(typeof e!="function"){console.warn(`[Octopus] The callback argument is not a function, in helper "${t}".`);return}if(!n&&a.#e.has(t)){console.warn(`[Octopus] The helper "${t}" already exists.`);return}a.#e.set(t,e)}static getHelper(t){if(!a.#e.has(t)){console.warn(`[Octopus] The helper "${t}" doesn't exist.`);return}return a.#e.get(t)}static#r=new Map;static setAction(t,e,n=!1){if(typeof e!="function"){console.warn(`[Octopus] The callback argument is not a function, in action "${t}".`);return}if(!n&&a.#r.has(t)){console.warn(`[Octopus] The action "${t}" already exists.`);return}a.#r.set(t,e)}static triggerAction(t,e=null){if(!a.#r.has(t)){console.warn(`[Octopus] The action "${t}" doesn't exist.`);return}a.#r.get(t)(e)}static#n=new Map;static setSecret(t,e,n,r=!1){if(!a.#n.has(t))a.#n.set(t,new Map);else if(!a.#n.get(t)?.has(n)&&!r)return;a.#n.get(t).set(n,e)}static getSecret(t,e){let n=a.#n.get(t)?.get(e);if(!n){console.warn(`[Octopus] The secret "${t}" can't be accessed.`);return}return n}static fullActive(){let t=new p("body");t.render(u.getTemplates()),t.use("addEventListener","submit",e=>{e.preventDefault(),new d(e.target.action,new FormData(e.target)).autoprocess()})}};export{c as octopus};
//# sourceMappingURL=octopus.min.js.map
